# Расчёты и наценки

**Версия:** 2.3.0

## Формулы расчётов

### 1. Базовая стоимость

```javascript
baseCost = Σ (price × quantity)
```

**Пример:**
```
Трансфер: $100 × 1 = $100
Отель: $80 × 6 = $480
Гид: $200 × 1 = $200
─────────────────────────
Базовая стоимость: $780
```

---

### 2. Индивидуальные наценки

```javascript
serviceTotal = price × quantity × (1 + markup / 100)
```

**Пример:**
```
Трансфер (10%): $100 × 1.10 = $110
Отель (10%): $480 × 1.10 = $528
Гид (15%): $200 × 1.15 = $230
─────────────────────────────────
С наценками: $868
```

---

### 3. Скрытая наценка

```javascript
hiddenMarkupAmount = baseCost × (hiddenMarkup / 100)
```

**Пример:**
```
Базовая стоимость: $780
Скрытая наценка 5%: $780 × 0.05 = $39
```

⚠️ **Не показывается клиенту в печати!**

---

### 4. НДС

```javascript
taxAmount = totalWithMarkups × (taxRate / 100)
```

**Пример:**
```
С наценками: $868
НДС 20%: $868 × 0.20 = $173.60
─────────────────────────────────
Итого клиенту: $1,041.60
```

---

### 5. Прибыль

```javascript
totalProfit = individualMarkups + hiddenMarkupAmount
```

**Пример:**
```
Индивидуальные: $88 ($868 - $780)
Скрытая: $39
─────────────────────────────────
Прибыль: $127
Маржа: 16.3% ($127 / $780)
```

---

## Типы наценок

### Индивидуальная (на услугу)

```
Применяется: К каждой услуге отдельно
Видна клиенту: Да (включена в итоговую цену)
Расчёт: price × (1 + markup%)
```

**Когда использовать:**
- Разная маржа на разные категории
- Компенсация рисков
- Премиум услуги

### Скрытая (на всю смету)

```
Применяется: Ко всей базовой стоимости
Видна клиенту: Нет (не в печати)
Расчёт: baseCost × hiddenMarkup%
```

**Когда использовать:**
- Общая маржа компании
- Операционные расходы
- Резерв на непредвиденное

---

## Примеры расчётов

### Пример 1: Простая смета

```
Услуги:
  Трансфер: $100 × 1 = $100 (наценка 10%)

Расчёт:
  Базовая: $100
  С наценкой: $110
  НДС (0%): $0
  Клиенту: $110

Прибыль: $10 (10%)
```

### Пример 2: Комплексная смета

```
Услуги:
  Трансфер: $100 × 2 = $200 (10%)
  Отель: $80 × 7 = $560 (10%)
  Экскурсии: $300 × 1 = $300 (15%)
  Гид: $150 × 3 = $450 (10%)

Расчёт:
  1. Базовая: $1,510
  2. Индивидуальные наценки:
     Трансфер: $200 → $220
     Отель: $560 → $616
     Экскурсии: $300 → $345
     Гид: $450 → $495
     Итого: $1,676
  3. Скрытая наценка 5%: $1,510 × 0.05 = $75.50
  4. НДС 0%: $0

  Клиенту: $1,676
  Ваша прибыль: $166 + $75.50 = $241.50
  Маржа: 16.0%
```

---

## Панель расчётов

```
┌────────────────────────────────┐
│ РАСЧЁТЫ                        │
├────────────────────────────────┤
│ Базовая стоимость:    $1,510   │
│ С наценками:          $1,676   │
│ + НДС (0%):           $0       │
│ ════════════════════════════   │
│ ИТОГО КЛИЕНТУ:        $1,676   │
│ ════════════════════════════   │
│                                │
│ ВАША ПРИБЫЛЬ:         $241.50  │
│ МАРЖА:                16.0%    │
└────────────────────────────────┘
```

---

## Настройка наценок

### Рекомендованные значения

| Категория | Наценка |
|-----------|---------|
| Трансферы | 10-15% |
| Отели | 10-20% |
| Питание | 5-10% |
| Экскурсии | 15-25% |
| Гиды | 10-15% |
| Активности | 15-20% |

### Скрытая наценка

```
Консервативно: 3-5%
Стандарт: 5-8%
Агрессивно: 8-12%
```

---

## Валидация

### Предупреждения

⚠️ **Система предупредит:**
- Наценка > 50% (подозрительно высокая)
- Наценка = 0% (нет прибыли)
- Отрицательная цена
- Цена = 0

### Ошибки

❌ **Система не даст сохранить:**
- Отрицательную наценку
- НДС > 100%
- PAX < 1

---

**Назад:** [← Редактирование](editing.md)
**Далее:** [Печать →](printing.md)
