# Массовые операции

**Версия:** 2.3.0

## Введение

Массовые операции позволяют изменять десятки и сотни услуг одновременно, экономя часы рутинной работы.

---

## Выбор услуг

### Способы выбора

**Checkbox:**
```
Клик на checkbox слева от услуги
Выбранные подсвечиваются
```

**Keyboard:**
```
Ctrl+Click  - Добавить/убрать одну услугу
Shift+Click - Выбрать диапазон от последней выбранной
Ctrl+A      - Выбрать все видимые
Escape      - Снять выбор
```

**Фильтр + Выбор:**
```
1. Применить фильтр (категория, цена, текст)
2. Ctrl+A → Выбираются только видимые
3. Применить операцию
```

### Индикация

```
Панель вверху:
┌──────────────────────────────────────┐
│ Выбрано: 15 из 127 услуг             │
│ [Снять выбор] [Инвертировать]        │
└──────────────────────────────────────┘
```

---

## Массовые изменения

### Изменение цен

**Установить фиксированную цену:**
```
Выбрать услуги → Кнопка "Цена" → Ввод: 100
Все выбранные → цена $100
```

**Умножить на коэффициент:**
```
Выбрать → "Цена" → "Умножить на..."
Ввод: 1.15 (повышение на 15%)
Применить → Все цены увеличены на 15%
```

**Добавить/вычесть сумму:**
```
"Цена" → "Добавить..."
Ввод: 10
Все цены +$10
```

**Округление:**
```
После изменения цены округляются:
  $25.3456 → $25.35
  $99.99   → $99.99
  $100.001 → $100.00
```

### Изменение наценок

**Установить единую наценку:**
```
Выбрать услуги → "Наценка %" → Ввод: 12
Все выбранные → markup = 12%
```

**По категориям:**
```
1. Фильтр: category = "accommodation"
2. Ctrl+A (выбрать все отели)
3. "Наценка %" → 10
4. Фильтр: category = "excursion"
5. Ctrl+A
6. "Наценка %" → 15
```

### Изменение категорий

**Переназначить категорию:**
```
Выбрать услуги → "Категория" → Dropdown
Выбрать новую категорию
Применить → Все перемещены
```

**Пример:** Перенести "Завтраки" из "other" в "food"

### Изменение количества

**Установить количество по умолчанию:**
```
Выбрать → "Количество" → Ввод: 1
Полезно для нормализации данных
```

---

## Массовое удаление

### Процесс

```
1. Выбрать услуги для удаления
2. Кнопка "Удалить выбранные (N)" или Delete key
3. Подтверждение:
   "Удалить N услуг?"
   [Создать backup] [Удалить] [Отмена]
4. Удаление выполнено
```

### Безопасность

**Автоматический backup:**
```
При удалении > 10 услуг:
  Backup создаётся автоматически
  Можно восстановить в течение 90 дней
```

**Предупреждения:**
```
Если услуга используется в сметах:
  "Услуга '{name}' используется в {count} сметах.
   Удаление из каталога НЕ удалит из смет.
   Продолжить?"
```

---

## Применение шаблонов

### Шаблоны операций

**Сохранить операцию как шаблон:**
```
1. Выполнить массовую операцию
2. Кнопка "Сохранить как шаблон"
3. Название: "Повышение цен на 10%"
4. Шаблон сохранён

Использование:
  Меню → Шаблоны операций →
  "Повышение цен на 10%" → Применить
```

**Стандартные шаблоны:**
```
- "Обнулить наценки" (markup = 0)
- "Стандартная наценка 12%" (markup = 12)
- "Количество = 1" (quantity = 1)
- "Округлить цены до целых"
```

---

## Примеры сценариев

### Сценарий 1: Сезонное повышение

**Задача:** Повысить все цены на 20% к высокому сезону

```
1. Backup
   Ctrl+Shift+B → "Низкий сезон 2025"

2. Выбрать все
   Ctrl+A

3. Умножить цены
   "Цена" → "Умножить на 1.20"

4. Применить
   127 услуг обновлено

5. Проверка
   Открыть несколько услуг → проверить цены

6. Сохранить
   Ctrl+S
```

**Время:** 2 минуты
**Vs ручное:** 2-3 часа для 100+ услуг

### Сценарий 2: Стандартизация наценок

**Задача:** Установить наценки по категориям

```
Трансферы → 10%:
1. Фильтр: transport
2. Ctrl+A
3. "Наценка %" → 10

Размещение → 12%:
1. Фильтр: accommodation
2. Ctrl+A
3. "Наценка %" → 12

Экскурсии → 15%:
1. Фильтр: excursion
2. Ctrl+A
3. "Наценка %" → 15

Активности → 18%:
1. Фильтр: activity
2. Ctrl+A
3. "Наценка %" → 18
```

**Результат:** Все услуги с правильными наценками

### Сценарий 3: Очистка дублей

**Задача:** Удалить дубликаты услуг

```
1. Сортировка по названию
   "Сортировать" → "По названию (A-Z)"

2. Визуальный поиск дублей
   Прокрутка списка, поиск повторов

3. Выбор дублей
   Ctrl+Click на каждом дубле

4. Сравнение перед удалением
   Проверить, что это действительно дубли
   (цены, описания должны совпадать)

5. Удаление
   Delete → Подтвердить

6. Проверка
   Остались ли пропущенные дубли
```

---

## API для массовых операций

### Batch Update API

```bash
POST /api/catalogs/:id/batch-update
Content-Type: application/json

{
  "filter": {
    "category": "accommodation"
  },
  "update": {
    "markup": 12
  }
}

Response:
{
  "updated": 15,
  "failed": 0
}
```

### Примеры скриптов

**Массовое обновление цен:**
```javascript
const catalog = await api.getCatalog('cat_001');
const multiplier = 1.15;

catalog.templates.forEach(t => {
  t.price = Math.round(t.price * multiplier * 100) / 100;
});

await api.updateCatalog('cat_001', catalog);
```

---

## Производительность

### Лимиты

```
Рекомендуется:     до 100 услуг за операцию
Допустимо:         до 500 услуг
Максимум:          1000 услуг (может тормозить)
```

### Оптимизация

**Если операция долгая:**
```
1. Разбить на части
   100 услуг → 5 операций по 20

2. Progress indicator
   "Обновлено 45 из 100..."

3. Фоновое выполнение
   Можно работать во время обновления
```

---

## Лучшие практики

**✅ Делайте:**
- Backup перед массовыми операциями
- Проверка на тестовой выборке (10-20 услуг)
- Проверка результата перед сохранением
- Документирование сложных операций

**❌ Избегайте:**
- Операций без backup
- Изменений без понимания последствий
- Удаления популярных услуг
- Игнорирования предупреждений

---

**Назад:** [← Advanced Features](index.md)
**Далее:** [Шаблоны →](templates.md)
