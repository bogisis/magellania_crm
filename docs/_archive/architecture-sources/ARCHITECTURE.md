# Quote Calculator v2.2.0 - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 17 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 2.2.0

---

## üìê –û–±–∑–æ—Ä –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

Quote Calculator - —ç—Ç–æ Full-Stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å **–º–æ–Ω–æ–ª–∏—Ç–Ω—ã–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º** –∏ **—Ñ–∞–π–ª–æ–≤—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º**.

### –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Browser (Client)                    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ    index.html (512KB, 9979 —Å—Ç—Ä–æ–∫)   ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ ProfessionalQuoteCalculator  ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - State management          ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Business logic            ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - UI rendering              ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Event handlers            ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ      APIClient               ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - HTTP requests             ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - Autosave (8 sec)          ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ  - File operations           ‚îÇ  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üï HTTP (REST API)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Backend Server (Node.js)               ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ     server.js (308 —Å—Ç—Ä–æ–∫)           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Express.js + CORS                  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Port: 3000                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                     ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  Endpoints:                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - GET  /api/estimates              ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - POST /api/estimates/:filename    ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - PUT  /api/estimates/:old/rename  ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - GET  /api/backups                ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - POST /api/backups/:id            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ  - POST /api/backups/:id/restore    ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üï File I/O
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      File System (JSON Storage)             ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  /estimate/                                 ‚îÇ
‚îÇ    ‚îî‚îÄ {name}_{date}_{pax}_{id}.json        ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  /backup/                                   ‚îÇ
‚îÇ    ‚îî‚îÄ {id}.json                             ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  /catalog/                                  ‚îÇ
‚îÇ    ‚îî‚îÄ {region}.json                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### 1. Load Quote Flow

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ Click "–û—Ç–∫—Ä—ã—Ç—å"
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  File Picker (Browser API)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ Select file.json
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  importQuoteFile(file)              ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  1. Read file content               ‚îÇ
‚îÇ  2. Detect format:                  ‚îÇ
‚îÇ     - v1.1.0 (metadata object) OR   ‚îÇ
‚îÇ     - v1.0.0 (flat structure)       ‚îÇ
‚îÇ  3. Generate filename               ‚îÇ
‚îÇ     with transliteration            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  apiClient.saveEstimate()           ‚îÇ
‚îÇ  POST /api/estimates/:filename      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  apiClient.saveBackup()             ‚îÇ
‚îÇ  POST /api/backups/:id              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  loadQuoteFromServer(filename)      ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚ö†Ô∏è CRITICAL SECTION:               ‚îÇ
‚îÇ  1. SET isLoadingQuote = true       ‚îÇ
‚îÇ  2. apiClient.loadEstimate()        ‚îÇ
‚îÇ  3. Update state:                   ‚îÇ
‚îÇ     - this.state.services = [...] ‚Üê REPLACES array
‚îÇ     - clientName, paxCount, etc.    ‚îÇ
‚îÇ  4. Render UI                       ‚îÇ
‚îÇ  5. updateCalculations()            ‚îÇ
‚îÇ     ‚Üí autosave BLOCKED by flag      ‚îÇ
‚îÇ  6. SET isLoadingQuote = false      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ UI ready‚îÇ with new quote loaded
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. Save Quote Flow (Manual)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ Ctrl+S –∏–ª–∏ Click "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  saveQuoteToServer(filename)        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  1. Sync DOM ‚Üí state                ‚îÇ
‚îÇ  2. Generate/reuse ID               ‚îÇ
‚îÇ  3. Generate new filename           ‚îÇ
‚îÇ     with transliteration            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Check: filename changed?           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ YES          ‚îÇ NO
     ‚Üì              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   Skip rename
‚îÇ Try rename   ‚îÇ
‚îÇ OLD ‚Üí NEW    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Rename success?                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ YES          ‚îÇ NO (ENOENT)
     ‚Üì              ‚Üì
   Continue    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
               ‚îÇ  Graceful        ‚îÇ
               ‚îÇ  fallback:       ‚îÇ
               ‚îÇ  Create new file ‚îÇ
               ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Dual Save (NO transaction!)        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  1. apiClient.saveEstimate()        ‚îÇ
‚îÇ     POST /api/estimates/:filename   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  2. apiClient.saveBackup()          ‚îÇ
‚îÇ     POST /api/backups/:id           ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  ‚ö†Ô∏è RISK: –ï—Å–ª–∏ #2 —É–ø–∞–¥—ë—Ç,           ‚îÇ
‚îÇ     –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Success ‚îÇ
‚îÇ saved   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 3. Autosave Flow (Every 8 seconds after change)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  User   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ –ò–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ (input, –¥–æ–±–∞–≤–ª—è–µ—Ç —É—Å–ª—É–≥—É, –∏ —Ç.–¥.)
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Event handler (onChange, onInput)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  debouncedAutosave() (2 —Å–µ–∫)        ‚îÇ
‚îÇ  Calls: autoSaveQuote()             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  autoSaveQuote()                    ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  GUARDS:                            ‚îÇ
‚îÇ  1. Check: !currentQuoteId?         ‚îÇ
‚îÇ     ‚Üí return (–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—É—é)   ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  2. Check: isLoadingQuote === true? ‚îÇ
‚îÇ     ‚Üí return ‚ö†Ô∏è CRITICAL GUARD       ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  3. Check: filename changed?        ‚îÇ
‚îÇ     ‚Üí rename estimate file          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  apiClient.scheduleAutosave()       ‚îÇ
‚îÇ  (8 second debounce)                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ After 8 seconds...
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Dual Save (same as manual save)    ‚îÇ
‚îÇ  - POST /api/estimates/:filename    ‚îÇ
‚îÇ  - POST /api/backups/:id            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇAuto-saved‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 4. Calculation Flow (Business Logic)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ Changes: price, quantity, markup, paxCount, etc.
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Event handler                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  debouncedUpdate() (150ms)          ‚îÇ
‚îÇ  Calls: updateCalculations()        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  updateCalculations()                           ‚îÇ
‚îÇ  ‚ö†Ô∏è CRITICAL: –ü–æ—Ä—è–¥–æ–∫ –ù–ï–õ–¨–ó–Ø –º–µ–Ω—è—Ç—å!            ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  FOR EACH service:                              ‚îÇ
‚îÇ    serviceCost = price √ó quantity               ‚îÇ
‚îÇ    serviceWithMarkup = calculateServiceTotal()  ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ    IF fullProfit:                               ‚îÇ
‚îÇ      fullProfitAmount += serviceWithMarkup      ‚îÇ
‚îÇ      baseCost += serviceWithMarkup              ‚îÇ
‚îÇ    ELSE:                                        ‚îÇ
‚îÇ      baseCost += serviceCost                    ‚îÇ
‚îÇ      individualMarkupAmount += markup           ‚îÇ
‚îÇ      IF !excludeFromMarkup:                     ‚îÇ
‚îÇ        baseCostForHiddenMarkup += serviceCost   ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  hiddenMarkupAmount =                           ‚îÇ
‚îÇ    baseCostForHiddenMarkup √ó (hiddenMarkup/100) ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  partnerCommissionAmount =                      ‚îÇ
‚îÇ    baseCost √ó (partnerCommission/100)           ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  totalWithHiddenMarkup =                        ‚îÇ
‚îÇ    totalWithIndividualMarkup +                  ‚îÇ
‚îÇ    hiddenMarkupAmount +                         ‚îÇ
‚îÇ    partnerCommissionAmount                      ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  clientTotal = totalWithHiddenMarkup            ‚îÇ
‚îÇ                                                 ‚îÇ
‚îÇ  totalProfit =                                  ‚îÇ
‚îÇ    individualMarkupAmount +                     ‚îÇ
‚îÇ    hiddenMarkupAmount +                         ‚îÇ
‚îÇ    fullProfitAmount                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ
     ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Update DOM elements                ‚îÇ
‚îÇ  - Total cost                       ‚îÇ
‚îÇ  - Profit                           ‚îÇ
‚îÇ  - Service totals                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
/Users/bogisis/Desktop/—Å–º–µ—Ç—ã/for_deploy/
‚îÇ
‚îú‚îÄ‚îÄ index.html (512KB, 9979 —Å—Ç—Ä–æ–∫) ‚Üê –ú–û–ù–û–õ–ò–¢
‚îÇ   ‚îú‚îÄ‚îÄ HTML structure (1-2565)
‚îÇ   ‚îú‚îÄ‚îÄ CSS styles (11-2564)
‚îÇ   ‚îî‚îÄ‚îÄ JavaScript (2566-9979)
‚îÇ       ‚îú‚îÄ‚îÄ ProfessionalQuoteCalculator class (2567-9200)
‚îÇ       ‚îú‚îÄ‚îÄ Server integration (9201-9600)
‚îÇ       ‚îî‚îÄ‚îÄ Global functions (9601-9979)
‚îÇ
‚îú‚îÄ‚îÄ server.js (308 —Å—Ç—Ä–æ–∫) ‚Üê Backend API
‚îú‚îÄ‚îÄ apiClient.js (179 —Å—Ç—Ä–æ–∫) ‚Üê API wrapper
‚îú‚îÄ‚îÄ utils.js (34 —Å—Ç—Ä–æ–∫) ‚Üê Utilities
‚îú‚îÄ‚îÄ version.js (32 —Å—Ç—Ä–æ–∫) ‚Üê Version control
‚îÇ
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ jest.config.js
‚îú‚îÄ‚îÄ test-setup.js
‚îÇ
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ server.test.js (11 —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ utils.test.js (10 —Ç–µ—Å—Ç–æ–≤)
‚îÇ
‚îú‚îÄ‚îÄ estimate/ ‚Üê –°–º–µ—Ç—ã –ø–æ filename
‚îÇ   ‚îú‚îÄ‚îÄ staryh_viktorovy_2025-10-17_8pax_fa5dacfeb2c7.json
‚îÇ   ‚îú‚îÄ‚îÄ dinar_hakimov_2025-11-04_15pax_d32c1b87d6d6.json
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ backup/ ‚Üê –°–º–µ—Ç—ã –ø–æ ID (UUID)
‚îÇ   ‚îú‚îÄ‚îÄ fa5dacfeb2c7.json
‚îÇ   ‚îú‚îÄ‚îÄ d32c1b87d6d6.json
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ catalog/ ‚Üê –ö–∞—Ç–∞–ª–æ–≥–∏ —É—Å–ª—É–≥ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
‚îÇ   ‚îî‚îÄ‚îÄ {region}.json
‚îÇ
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ ARCHITECTURE.md ‚Üê –≠—Ç–æ—Ç —Ñ–∞–π–ª
    ‚îú‚îÄ‚îÄ CLAUDE.md ‚Üê –ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ CHANGELOG.md
    ‚îú‚îÄ‚îÄ CRITICAL_ISSUES.md
    ‚îú‚îÄ‚îÄ RELEASE_NOTES_v2.1.0.md
    ‚îú‚îÄ‚îÄ TECHNICAL_DOCS_v2.1.0.md
    ‚îú‚îÄ‚îÄ USER_GUIDE_v2.1.0.md
    ‚îî‚îÄ‚îÄ ...
```

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Estimate File (v1.1.0)

```json
{
  "version": "1.1.0",
  "appVersion": "2.2.0",
  "id": "fa5dacfeb2c7",
  "timestamp": "2025-10-17T14:12:12.211Z",

  "clientName": "–°—Ç–∞—Ä—ã—Ö_–≤–∏–∫—Ç–æ—Ä–æ–≤—ã",
  "clientPhone": "+7 123 456 7890",
  "clientEmail": "client@example.com",

  "paxCount": 8,
  "tourStart": "2025-11-04",
  "tourEnd": "2025-11-14",

  "services": [ /* Service objects */ ],

  "hiddenMarkup": 0,
  "partnerCommission": 0,
  "taxRate": 0,

  "programDescription": "...",
  "quoteComments": "..."
}
```

### Service Object

```javascript
{
  // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
  id: "1760376984252",
  name: "–í—Å—Ç—Ä–µ—á–∞ –≥—Ä—É–ø–ø—ã –≤ –∞—ç—Ä–æ–ø–æ—Ä—Ç—É",
  description: "–†–∞–±–æ—Ç–∞ —Ä—É—Å—Å–∫–æ–≥–æ–≤–æ—Ä—è—â–µ–≥–æ –≥–∏–¥–∞",
  day: 1,
  price: 100,
  quantity: 1,

  // –†–∞—Å—á—ë—Ç—ã
  markup: 0,                    // –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ %
  excludeFromMarkup: false,     // –ò—Å–∫–ª—é—á–∏—Ç—å –∏–∑ —Å–∫—Ä—ã—Ç–æ–π –Ω–∞—Ü–µ–Ω–∫–∏
  fullProfit: true,             // –í—Å—è —Å—É–º–º–∞ = –ø—Ä–∏–±—ã–ª—å

  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  contractor: "Magellania travel",
  region: "Ushuaia",

  // –ß–µ–∫–ª–∏—Å—Ç (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
  done: true,                   // –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ
  paid: false,                  // –û–ø–ª–∞—á–µ–Ω–æ
  comment: ""                   // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä–∞
}
```

---

## üîê State Management

### State Object

```javascript
this.state = {
  // –£—Å–ª—É–≥–∏
  services: [],                   // –ú–∞—Å—Å–∏–≤ Service –æ–±—ä–µ–∫—Ç–æ–≤
  optionalServices: [],           // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ (–Ω–µ –≤ —Å–º–µ—Ç—É)
  selectedServices: new Set(),    // –î–ª—è bulk operations

  // –ö–ª–∏–µ–Ω—Ç
  clientName: '',
  clientPhone: '',
  clientEmail: '',

  // –¢—É—Ä
  tourStart: '',
  tourEnd: '',
  paxCount: 27,

  // –†–∞—Å—á—ë—Ç—ã
  hiddenMarkup: 0,               // –°–∫—Ä—ã—Ç–∞—è –Ω–∞—Ü–µ–Ω–∫–∞ %
  partnerCommission: 0,          // –ö–æ–º–∏—Å—Å–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–∞ %
  taxRate: 0,                    // –ù–î–° %

  // –û–ø–∏—Å–∞–Ω–∏—è
  programDescription: '',         // –î–ª—è –ø–µ—á–∞—Ç–∏
  quoteComments: '',             // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å–º–µ—Ç–µ

  // UI
  activeCategory: 'all',
  servicesViewMode: 'cards',     // 'cards' | 'table'
  servicesSortBy: 'order',       // 'order' | 'day' | 'contractor'
  servicesSortDirection: 'asc',

  // –§–∞–π–ª—ã
  currentQuoteFile: '',          // –ò–º—è –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ —Ñ–∞–π–ª–∞
  currentQuoteId: null,          // UUID —Å–º–µ—Ç—ã
  isQuoteSaved: true,            // –§–ª–∞–≥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è

  // –ß–µ–∫–ª–∏—Å—Ç (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
  currentMode: 'quote',          // 'quote' | 'checklist'
  checklistViewMode: 'day',      // 'day' | 'supplier'
  checklistFilter: 'all'         // 'all' | 'booked' | 'paid'
}
```

### Critical Flags

```javascript
// Race condition prevention
this.isLoadingQuote = false;   // –ë–ª–æ–∫–∏—Ä—É–µ—Ç autosave –≤–æ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏

// Timeout tracking
this.timeoutIds = {
  update: null,
  search: null,
  detailRender: null,
  bulkUpdate: null,
  autosave: null
};
```

---

## üîß –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### ProfessionalQuoteCalculator (index.html:2567-9200)

**–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä (2567-2720)**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π, config, state
- –°–æ–∑–¥–∞–Ω–∏–µ debounced —Ñ—É–Ω–∫—Ü–∏–π
- –í—ã–∑–æ–≤ init()

**Configuration (2576-2597)**
```javascript
this.config = {
  currency: '$',
  maxFileSize: 5 * 1024 * 1024,  // 5MB
  debounceDelays: {
    search: 300,
    calculations: 150,
    detailRender: 100,
    bulkControls: 50,
    autosave: 2000
  },
  validation: {
    maxServices: 1000,
    maxServiceNameLength: 100,
    minPrice: 0
  }
}
```

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**

| –ú–µ—Ç–æ–¥ | –°—Ç—Ä–æ–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|----------|
| `init()` | 2721-2800 | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, event listeners |
| `updateCalculations()` | 4995-5094 | ‚ö†Ô∏è –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á—ë—Ç–æ–≤ |
| `renderServices()` | 6000-6500 | –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ —É—Å–ª—É–≥ |
| `addService()` | 3400-3550 | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏ –≤ —Å–º–µ—Ç—É |
| `autoSaveQuote()` | 9423-9480 | –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å guard flags |
| `loadQuoteFromServer()` | 9483-9533 | –ó–∞–≥—Ä—É–∑–∫–∞ —Å–º–µ—Ç—ã —Å —Å–µ—Ä–≤–µ—Ä–∞ |
| `saveQuoteToServer()` | 9346-9420 | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–º–µ—Ç—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä |

### APIClient (apiClient.js:1-179)

**–ú–µ—Ç–æ–¥—ã:**

| –ú–µ—Ç–æ–¥ | –°—Ç—Ä–æ–∫–∏ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|--------|----------|
| `saveEstimate()` | 20-35 | POST /api/estimates/:filename |
| `loadEstimate()` | 37-52 | GET /api/estimates/:filename |
| `renameEstimate()` | 85-100 | PUT /api/estimates/:old/rename |
| `saveBackup()` | 120-135 | POST /api/backups/:id |
| `scheduleAutosave()` | 141-162 | Debounced save (8 sec) |

**Autosave –º–µ—Ö–∞–Ω–∏–∑–º:**
```javascript
scheduleAutosave(data, filename) {
  if (!filename || !data.id) return;

  if (this.autosaveTimeout) {
    clearTimeout(this.autosaveTimeout);
  }

  this.autosaveTimeout = setTimeout(async () => {
    await this.saveEstimate(data, filename);
    await this.saveBackup(data, data.id);
  }, 8000); // 8 seconds
}
```

---

## üß™ Testing Architecture

### Backend Tests (server.test.js)
- **11 —Ç–µ—Å—Ç–æ–≤** –¥–ª—è API endpoints
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Supertest + Jest
- Test environment: –ø–æ—Ä—Ç 3001, –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

### Utils Tests (utils.test.js)
- **10 —Ç–µ—Å—Ç–æ–≤** –¥–ª—è —É—Ç–∏–ª–∏—Ç
- transliterate(): 6 —Ç–µ—Å—Ç–æ–≤
- generateId(): 4 —Ç–µ—Å—Ç–∞

### Frontend Tests
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –º–æ–¥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. –ú–æ–Ω–æ–ª–∏—Ç–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (P0)
**–ü—Ä–æ–±–ª–µ–º–∞:** 9979 —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º HTML —Ñ–∞–π–ª–µ
**–í–ª–∏—è–Ω–∏–µ:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ code review
- –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- –ù–µ—Ç hot module replacement
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ unit-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è v2.4.0):**
```
/src
  /core
    ProfessionalQuoteCalculator.js
  /modules
    calculations.js
    rendering.js
    state.js
  /ui
    components/
  /styles
    main.css
```

### 2. Dual storage –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (P0)
**–ü—Ä–æ–±–ª–µ–º–∞:**
```javascript
await apiClient.saveEstimate(data, filename);  // –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å
await apiClient.saveBackup(data, id);          // –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å
```

**–°—Ü–µ–Ω–∞—Ä–∏–π —Å–±–æ—è:**
1. saveEstimate() —É—Å–ø–µ—à–µ–Ω ‚Üí estimate/ –æ–±–Ω–æ–≤–ª—ë–Ω
2. saveBackup() –ø–∞–¥–∞–µ—Ç ‚Üí backup/ –Ω–µ –æ–±–Ω–æ–≤–ª—ë–Ω
3. **–î–∞–Ω–Ω—ã–µ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã**

**–†–µ—à–µ–Ω–∏–µ (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è v2.3.0):**
```javascript
async saveQuoteTransactional(data, filename) {
  const tempBackupPath = `${data.id}.temp`;

  try {
    await apiClient.saveBackup(data, tempBackupPath);
    await apiClient.saveEstimate(data, filename);
    await apiClient.renameBackup(tempBackupPath, data.id);
    return { success: true };
  } catch (err) {
    await apiClient.deleteBackup(tempBackupPath);
    throw err;
  }
}
```

### 3. Race conditions –≤ autosave (P1)
**–ü—Ä–æ–±–ª–µ–º–∞:** Autosave –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç—å —Å–≤–µ–∂–µ–∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–¢–µ–∫—É—â–∞—è –º–∏—Ç–∏–≥–∞—Ü–∏—è:**
```javascript
// Guard flag
loadQuoteFromServer() {
  this.isLoadingQuote = true;  // –ë–ª–æ–∫–∏—Ä—É–µ—Ç autosave
  // ... load ...
  this.isLoadingQuote = false;
}

autoSaveQuote() {
  if (this.isLoadingQuote) return;  // Guard
  // ... save ...
}
```

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** Autosave —Å–ª–∏—à–∫–æ–º –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å UI events

---

## üìã Roadmap

### v2.3.0 (–±–ª–∏–∂–∞–π—à–∏–µ 1-2 –Ω–µ–¥–µ–ª–∏)
- ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
- ‚úÖ Error boundaries –¥–ª—è async –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è transliteration (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞)

### v2.4.0 (2-4 –Ω–µ–¥–µ–ª–∏)
- ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ CSS –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ –Ω–∞ –º–æ–¥—É–ª–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–±–æ—Ä–∫–∏ (Vite)

### v2.5.0 (1-2 –º–µ—Å—è—Ü–∞)
- ‚úÖ State Manager —Å undo/redo
- ‚úÖ Event system (pub/sub)
- ‚úÖ Frontend unit —Ç–µ—Å—Ç—ã

### v3.0.0 (3-4 –º–µ—Å—è—Ü–∞)
- ‚úÖ –ü–æ–ª–Ω–∞—è –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ï–¥–∏–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (–≤–º–µ—Å—Ç–æ dual)
- ‚úÖ Checklist –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ E2E —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **CLAUDE.md** - –ì–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- **CRITICAL_ISSUES.md** - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –∏ —Ä–µ—à–µ–Ω–∏–π
- **CHANGELOG.md** - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- **USER_GUIDE_v2.1.0.md** - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 17 –æ–∫—Ç—è–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä:** Code Review Team
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0
