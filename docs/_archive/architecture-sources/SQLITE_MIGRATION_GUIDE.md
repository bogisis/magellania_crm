# SQLite Migration Guide - Quote Calculator v2.3.0

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 26 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0.0
**–°—Ç–∞—Ç—É—Å:** Ready for Production

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏](#–ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞-–º–∏–≥—Ä–∞—Ü–∏–∏)
3. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
4. [–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è](#–ø–æ—à–∞–≥–æ–≤–∞—è-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
5. [–û—Ç–∫–∞—Ç (Rollback)](#–æ—Ç–∫–∞—Ç-rollback)
6. [FAQ](#faq)
7. [Troubleshooting](#troubleshooting)

---

## üéØ –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –≥–∞–π–¥ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é Quote Calculator —Å **file-based storage** –Ω–∞ **SQLite database**.

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (File Storage)
```
estimate/
  ‚îú‚îÄ client1_2025-10-20_5pax_abc123.json
  ‚îú‚îÄ client2_2025-10-21_10pax_def456.json
  ‚îî‚îÄ ...

backup/
  ‚îú‚îÄ abc123.json
  ‚îú‚îÄ def456.json
  ‚îî‚îÄ ...

catalog/
  ‚îî‚îÄ catalog.json
```

### –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (SQLite)
```
db/
  ‚îî‚îÄ quotes.db  ‚Üê –û–¥–∏–Ω —Ñ–∞–π–ª –¥–ª—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö
```

---

## ‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### –†–µ—à–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | File Storage | SQLite |
|----------|--------------|--------|
| **–†–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** estimate/ –∏ backup/ | ‚ùå Dual save –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å | ‚úÖ ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| **Race conditions** –≤ autosave | ‚ö†Ô∏è Guard flags | ‚úÖ Optimistic locking |
| **Concurrent edits** | ‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã | ‚úÖ Version tracking |
| **Undo/Redo** | ‚ùå –ù–µ—Ç | ‚úÖ Audit log –≥–æ—Ç–æ–≤ |
| **–ü–æ–∏—Å–∫** | üêå –ú–µ–¥–ª–µ–Ω–Ω–æ | ‚ö° –ò–Ω–¥–µ–∫—Å—ã |
| **Backup** | üìÅ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ø–æ–∫ | üì¶ –û–¥–∏–Ω —Ñ–∞–π–ª |

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–π –¥–µ–ø–ª–æ–π** - –æ–¥–∏–Ω —Ñ–∞–π–ª –ë–î –≤–º–µ—Å—Ç–æ —Ç—ã—Å—è—á JSON —Ñ–∞–π–ª–æ–≤
- ‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –Ω–µ—Ç partial writes
- ‚úÖ **Data integrity** - foreign keys, constraints
- ‚úÖ **Upgrade path** - –ª–µ–≥–∫–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ PostgreSQL –ø–æ–∑–∂–µ
- ‚úÖ **Performance** - –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

---

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- ‚úÖ Node.js >= 18.0.0
- ‚úÖ ~50MB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞ (–¥–ª—è –ë–î)
- ‚úÖ –ü—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `db/`

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
# 1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞
git pull origin main

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–≤–∫–ª—é—á–∞—è better-sqlite3)
npm install

# 3. –°–æ–∑–¥–∞–π—Ç–µ backup —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
cp -r estimate/ estimate_backup/
cp -r backup/ backup_backup/
cp -r catalog/ catalog_backup/

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backup —Å–æ–∑–¥–∞–Ω
ls -la *_backup/
```

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (5 –º–∏–Ω—É—Ç)

#### 1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä
npm start

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ health check
curl http://localhost:3000/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ—Ç
ls -1 estimate/*.json | wc -l
```

#### 1.2. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
# –ò–õ–ò
pkill -f "node server.js"
```

### –§–∞–∑–∞ 2: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (10-30 –º–∏–Ω—É—Ç)

#### 2.1. Dry run (–ø—Ä–æ–±–Ω—ã–π –∑–∞–ø—É—Å–∫)

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ –ë–ï–ó —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞
npm run migrate:dry-run
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
==================================================================
üöÄ Quote Calculator - Migration to SQLite
==================================================================
‚ö†Ô∏è  DRY RUN MODE - No changes will be made

Options:
  Dry run: true
  Verbose: true
  Validate: false

==================================================================
üì¶ Initializing Storage
==================================================================
‚úì FileStorage initialized
‚úì SQLiteStorage initialized

==================================================================
üìÑ Migrating Estimates
==================================================================
Found 6 estimates

  Processing: client1_2025-10-20_5pax_abc123.json
  ‚úì Migrated: client1_2025-10-20_5pax_abc123.json
  ...

‚úì Estimates: 6 migrated, 0 failed, 0 skipped
...
```

#### 2.2. –†–µ–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
npm run migrate:run
```

**–í–∞–∂–Ω–æ:** –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç:
- `db/quotes.db` - SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- `migration_report.json` - –æ—Ç—á–µ—Ç –æ –º–∏–≥—Ä–∞—Ü–∏–∏

#### 2.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—á–µ—Ç–∞

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
cat migration_report.json | jq .

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–æ
cat migration_report.json | jq '.summary'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "totalItems": 12,
  "totalSuccess": 12,
  "totalFailed": 0,
  "totalSkipped": 0
}
```

### –§–∞–∑–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ SQLite (15 –º–∏–Ω—É—Ç)

#### 3.1. –ó–∞–ø—É—Å–∫ —Å SQLite storage

```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env
nano .env
```

**–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ .env:**
```bash
STORAGE_TYPE=sqlite
DUAL_WRITE_MODE=false
```

#### 3.2. –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ server.js –Ω–∞ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é
mv server.js server-old.js
cp server-with-db.js server.js

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm start
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
Storage configuration:
  Type: sqlite
  Dual-write: false
  Test mode: false
Using SQLite storage
‚úì Primary storage initialized

==================================================
Quote Calculator Server v2.3.0
==================================================
Server running on port 3000
Open http://localhost:3000 in browser
Storage: sqlite
==================================================
```

#### 3.3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

```bash
# Health check
curl http://localhost:3000/health | jq .

# –°–ø–∏—Å–æ–∫ —Å–º–µ—Ç
curl http://localhost:3000/api/estimates | jq '.estimates[] | {filename, clientName}'

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–¥–Ω—É —Å–º–µ—Ç—É
curl http://localhost:3000/api/estimates/client1_2025-10-20_5pax_abc123.json | jq .
```

#### 3.4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–º–µ—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
3. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–º–µ—Ç—É
4. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ
5. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é —Å–º–µ—Ç—É
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –§–∞–∑–∞ 4: Dual-Write —Ä–µ–∂–∏–º (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 1 –Ω–µ–¥–µ–ª—è)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ dual-write —Ä–µ–∂–∏–º:

```bash
# .env
STORAGE_TYPE=sqlite
DUAL_WRITE_MODE=true
```

–í —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∏—à—É—Ç—Å—è **–∏ –≤ SQLite, –∏ –≤ —Ñ–∞–π–ª—ã**. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –ë—ã—Å—Ç—Ä–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ file storage
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ SQLite

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –†–∞–±–æ—Ç–∞—Ç—å –≤ dual-write —Ä–µ–∂–∏–º–µ 3-7 –¥–Ω–µ–π –ø–µ—Ä–µ–¥ –ø–æ–ª–Ω—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º.

### –§–∞–∑–∞ 5: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è (5 –º–∏–Ω—É—Ç)

#### 5.1. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ dual-write

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# .env
STORAGE_TYPE=sqlite
DUAL_WRITE_MODE=false
```

#### 5.2. Backup –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–π—Ç–µ backup –ë–î
cp db/quotes.db db/quotes_$(date +%Y%m%d).backup.db

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –î–æ–±–∞–≤—å—Ç–µ –≤ crontab:
# 0 3 * * * cp /path/to/db/quotes.db /path/to/backups/quotes_$(date +\%Y\%m\%d).backup.db
```

#### 5.3. –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤
tar -czf legacy_file_storage_$(date +%Y%m%d).tar.gz estimate/ backup/ catalog/

# –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –≤ –∞—Ä—Ö–∏–≤
mkdir -p archive/
mv legacy_file_storage_*.tar.gz archive/

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
# rm -rf estimate/ backup/ catalog/
```

---

## üîÑ –û—Ç–∫–∞—Ç (Rollback)

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–∞ file storage:

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç (–µ—Å–ª–∏ dual-write –±—ã–ª –≤–∫–ª—é—á–µ–Ω)

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pkill -f "node server.js"

# 2. –í–µ—Ä–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π server.js
mv server-old.js server.js

# 3. –£–¥–∞–ª–∏—Ç–µ .env (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π file storage)
rm .env

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm start
```

### –ü–æ–ª–Ω—ã–π –æ—Ç–∫–∞—Ç (–µ—Å–ª–∏ dual-write –Ω–µ –±—ã–ª –≤–∫–ª—é—á–µ–Ω)

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pkill -f "node server.js"

# 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backup
rm -rf estimate/ backup/ catalog/
cp -r estimate_backup/ estimate/
cp -r backup_backup/ backup/
cp -r catalog_backup/ catalog/

# 3. –í–µ—Ä–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π server.js
mv server-old.js server.js

# 4. –£–¥–∞–ª–∏—Ç–µ .env –∏ –ë–î
rm .env
rm -rf db/

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm start
```

---

## ‚ùì FAQ

### Q: –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—è?

**A:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã—Ö:
- 10 —Å–º–µ—Ç: ~1 –º–∏–Ω—É—Ç–∞
- 100 —Å–º–µ—Ç: ~2-3 –º–∏–Ω—É—Ç—ã
- 1000 —Å–º–µ—Ç: ~10-15 –º–∏–Ω—É—Ç

### Q: –ë—É–¥—É—Ç –ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ JSON —Ñ–∞–π–ª—ã?

**A:** –î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å JSON —Ñ–∞–π–ª—ã –∫–∞–∫ –æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ UI. –û–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ SQLite.

### Q: –ú–æ–∂–Ω–æ –ª–∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ file storage?

**A:** –î–∞, –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç —á–µ—Ä–µ–∑ `.env`:
```bash
STORAGE_TYPE=file
```

### Q: –£–≤–µ–ª–∏—á–∏—Ç—Å—è –ª–∏ —Ä–∞–∑–º–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞?

**A:** –ù–µ—Ç, SQLite –æ–±—ã—á–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ:
- File storage: ~N —Ñ–∞–π–ª–æ–≤ √ó (—Ä–∞–∑–º–µ—Ä + metadata)
- SQLite: –æ–¥–∏–Ω —Ñ–∞–π–ª, —Å–∂–∞—Ç–∏–µ, –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–∏–º–µ—Ä: 100 —Å–º–µ—Ç
- Files: ~15MB (—Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ)
- SQLite: ~8MB (–µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª)

### Q: –ö–∞–∫ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ PostgreSQL –≤ –±—É–¥—É—â–µ–º?

**A:** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞:
1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `PostgresStorage` (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ SQLiteStorage)
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ SQLite
3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ PostgreSQL
4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `STORAGE_TYPE=postgres`

### Q: –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –æ—à–∏–±–∫–∞–º–∏ –º–∏–≥—Ä–∞—Ü–∏–∏?

**A:** –°–º–æ—Ç—Ä–∏—Ç–µ `migration_report.json`:
```bash
cat migration_report.json | jq '.errors'
```

–ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è –≤ —Å–µ–∫—Ü–∏–∏ [Troubleshooting](#troubleshooting).

---

## üîß Troubleshooting

### –û—à–∏–±–∫–∞: "better-sqlite3 not installed"

```bash
# –†–µ—à–µ–Ω–∏–µ:
npm install better-sqlite3

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ persist, —É–¥–∞–ª–∏—Ç–µ node_modules –∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ
rm -rf node_modules package-lock.json
npm install
```

### –û—à–∏–±–∫–∞: "EACCES: permission denied, mkdir 'db'"

```bash
# –†–µ—à–µ–Ω–∏–µ: –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∑–∞–ø–∏—Å—å
mkdir -p db
chmod 755 db
```

### –û—à–∏–±–∫–∞: "Database is locked"

```bash
# –†–µ—à–µ–Ω–∏–µ: –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ë–î
pkill -f "node server.js"

# –£–¥–∞–ª–∏—Ç–µ lock —Ñ–∞–π–ª—ã
rm -f db/*.db-shm db/*.db-wal

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm start
```

### –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–º–µ—Ç—ã –Ω–µ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—á–µ—Ç
cat migration_report.json | jq '.stats.estimates'

# –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –æ—à–∏–±–∫–∏
cat migration_report.json | jq '.errors[] | select(.type == "estimate")'

# –ò—Å–ø—Ä–∞–≤—å—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ JSON —Ñ–∞–π–ª—ã –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
npm run migrate:run
```

### Optimistic locking conflicts

–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏ "Concurrent modification detected":

```javascript
// –í UI –æ–±—Ä–∞–±–æ—Ç–∞–π—Ç–µ 409 –æ—Ç–≤–µ—Ç—ã:
try {
    await apiClient.saveEstimate(filename, data);
} catch (err) {
    if (err.code === 'CONFLICT') {
        // –ü—Ä–µ–¥–ª–æ–∂–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é reload
        if (confirm('–î–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å?')) {
            location.reload();
        }
    }
}
```

---

## üìä Checklist

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç checklist –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
- [ ] Backup —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω
- [ ] `npm install` –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ
- [ ] –¢–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –ú–∏–≥—Ä–∞—Ü–∏—è
- [ ] Dry run –∑–∞–≤–µ—Ä—à–µ–Ω –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –†–µ–∞–ª—å–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
- [ ] `migration_report.json` –ø—Ä–æ–≤–µ—Ä–µ–Ω
- [ ] –í—Å–µ —Å–º–µ—Ç—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–ª–∏ (failed = 0)

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å `STORAGE_TYPE=sqlite`
- [ ] Health check –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –°–ø–∏—Å–æ–∫ —Å–º–µ—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–º–µ—Ç—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å–º–µ—Ç—ã —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö–∞—Ç–∞–ª–æ–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
- [ ] Dual-write –æ—Ç–∫–ª—é—á–µ–Ω
- [ ] Backup –ë–î —Å–æ–∑–¥–∞–Ω
- [ ] –°—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   ```bash
   tail -f server.log
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health endpoint:**
   ```bash
   curl http://localhost:3000/health | jq .
   ```

3. **–û—Ç–∫–∞—Ç–∏—Ç–µ—Å—å –Ω–∞ file storage** –µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

4. **–°–æ–∑–¥–∞–π—Ç–µ issue** —Å:
   - `migration_report.json`
   - –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
   - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

---

## ‚úÖ Summary

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

- ‚úÖ **–ï–¥–∏–Ω—ã–π —Ñ–∞–π–ª –ë–î** –≤–º–µ—Å—Ç–æ —Ç—ã—Å—è—á JSON —Ñ–∞–π–ª–æ–≤
- ‚úÖ **ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –Ω–µ—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ **Optimistic locking** - –∑–∞—â–∏—Ç–∞ –æ—Ç concurrent edits
- ‚úÖ **Audit log ready** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ undo/redo
- ‚úÖ **Performance** - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ **Upgrade path** - –ª–µ–≥–∫–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ PostgreSQL

**–í—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏:** 30-60 –º–∏–Ω—É—Ç (–≤–∫–ª—é—á–∞—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
**–†–∏—Å–∫–∏:** –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ (–µ—Å—Ç—å rollback)
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 26 –æ–∫—Ç—è–±—Ä—è 2025
**–ê–≤—Ç–æ—Ä:** Quote Calculator Team
