# Quote Calculator v3.0 - SSL/TLS Configuration
# Additional configuration for HTTPS with Let's Encrypt
# Included in cloud deployments

# ============================================================================
# Let's Encrypt ACME Challenge
# ============================================================================

# Allow certbot to complete ACME challenge for SSL certificate validation
location /.well-known/acme-challenge/ {
    root /var/www/certbot;
    allow all;
}

# ============================================================================
# HTTPS Enforcement
# ============================================================================

# Redirect all HTTP traffic to HTTPS (uncomment when SSL is ready)
# This should be in the main server block listening on port 80
#
# server {
#     listen 80;
#     server_name ${DOMAIN};
#
#     location /.well-known/acme-challenge/ {
#         root /var/www/certbot;
#     }
#
#     location / {
#         return 301 https://$server_name$request_uri;
#     }
# }

# ============================================================================
# SSL Configuration Override
# ============================================================================

# These settings override the default SSL config in nginx.conf
# Optimized for Let's Encrypt certificates

# SSL Certificate paths (Let's Encrypt)
# ssl_certificate /etc/letsencrypt/live/${DOMAIN}/fullchain.pem;
# ssl_certificate_key /etc/letsencrypt/live/${DOMAIN}/privkey.pem;

# Trusted certificate for OCSP stapling
# ssl_trusted_certificate /etc/letsencrypt/live/${DOMAIN}/chain.pem;

# ============================================================================
# Security Headers for HTTPS
# ============================================================================

# HTTP Strict Transport Security (HSTS)
# Tells browsers to always use HTTPS for this domain
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# ============================================================================
# Notes
# ============================================================================

# 1. Initial certificate generation:
#    docker-compose -f docker-compose.yml -f docker-compose.prod.yml -f docker-compose.cloud.yml \
#      run --rm certbot-init
#
# 2. Certificate auto-renewal:
#    Handled automatically by certbot service (every 12 hours)
#
# 3. Certificate location:
#    /etc/letsencrypt/live/${DOMAIN}/fullchain.pem
#    /etc/letsencrypt/live/${DOMAIN}/privkey.pem
#
# 4. Testing SSL configuration:
#    https://www.ssllabs.com/ssltest/
#
# 5. Backup certificates:
#    docker volume backup quote-certbot-etc
