# Quote Calculator v3.0 - Staging Environment Variables
# ============================================================================
# ВАЖНО: Этот файл используется для staging контейнера на VPS
# Staging используется для финальных тестов перед деплоем в production
# ============================================================================

# ============================================================================
# Server Configuration
# ============================================================================

# Server port (внутренний порт контейнера)
PORT=4001

# Node environment
NODE_ENV=staging

# Application environment
APP_ENV=staging

# ============================================================================
# Storage Configuration
# ============================================================================

# Storage type: 'sqlite'
STORAGE_TYPE=sqlite

# Database path (внутри контейнера, отдельная БД от production)
DB_PATH=/app/db/quotes.db

# Dual-write mode (можно включить для тестирования миграции)
DUAL_WRITE_MODE=false

# ============================================================================
# Data Integrity & Safety
# ============================================================================

# Enable audit logging
ENABLE_AUDIT_LOG=true

# Enable optimistic locking
ENABLE_OPTIMISTIC_LOCKING=true

# ============================================================================
# Performance
# ============================================================================

# JSON payload size limit
JSON_LIMIT=50mb

# Request timeout (30 seconds)
REQUEST_TIMEOUT=30000

# ============================================================================
# Logging (Winston)
# ============================================================================

# Log level: debug для staging (больше информации для отладки)
LOG_LEVEL=debug

# Console logging (ВКЛЮЧЕНО для staging - удобнее смотреть логи)
LOG_CONSOLE=true

# Log directory (внутри контейнера)
LOG_DIR=/app/logs

# SQL query logging (ВКЛЮЧЕНО для staging - помогает отлаживать)
LOG_SQL_QUERIES=true

# ============================================================================
# Security
# ============================================================================

# CORS origins (для staging можно оставить более мягкие настройки)
CORS_ORIGIN=*

# Допустимые HTTP методы
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS

# ============================================================================
# Backup Configuration
# ============================================================================

# Для staging бэкапы опциональны
# При необходимости можно использовать:
# npm run db:export:staging

# ============================================================================
# Health Check Configuration
# ============================================================================

# Health check endpoint: /health
# Интервал проверки: 30s (настроено в docker-compose.vps.yml)

# ============================================================================
# Staging Notes
# ============================================================================
#
# 1. Назначение Staging:
#    - Финальное тестирование перед production деплоем
#    - Проверка миграций БД
#    - Тестирование новых функций в production-like окружении
#    - Не используется для активной разработки (development)
#
# 2. Workflow:
#    Local Dev → Local Staging → VPS Staging → VPS Production
#
#    a) Разработка и первичные тесты:
#       - Локальная разработка (docker-compose.dev.yml)
#       - Локальный staging (docker-compose.yml)
#
#    b) Финальные тесты (на VPS):
#       - Деплой в VPS staging
#       - Тестирование на staging.yourdomain.com
#       - Проверка миграции данных
#
#    c) Production деплой:
#       - После подтверждения тестов
#       - Ручной деплой в production
#
# 3. Миграция данных в staging:
#    - Экспорт из local: npm run db:export:local
#    - Импорт в staging: npm run db:import:staging <file> vps-staging
#    - Проверка: curl https://staging.yourdomain.com/health
#
# 4. Мониторинг staging:
#    - Логи: docker-compose -f docker-compose.vps.yml logs -f quote-staging
#    - Health: curl http://localhost:4001/health
#    - Portainer: https://your-vps-ip:9443
#
# 5. Ресурсы:
#    - Staging использует меньше ресурсов чем production
#    - Limits: 0.5 CPU, 256MB RAM
#    - Отдельные volumes от production
#
# 6. Отличия от production:
#    - Более verbose logging (debug level)
#    - Console logging включен
#    - SQL query logging включен
#    - Можно тестировать рискованные операции
#
# 7. Доступ:
#    - URL: https://staging.yourdomain.com (через nginx)
#    - Прямой доступ: http://vps-ip:4001 (если порт открыт в UFW)
#    - Health check: http://vps-ip:4001/health
#
# ============================================================================
