# MAGELLANIA CRM - Quote Calculator v2.3.1

**Production-Ready** –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –¥–ª—è —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞ —Å –ø–æ–ª–Ω—ã–º multi-tenancy –∏ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π.

[![Version](https://img.shields.io/badge/version-2.3.1-blue.svg)](https://github.com/your-repo/quote-calculator)
[![Status](https://img.shields.io/badge/status-production--ready-green.svg)](https://github.com/your-repo/quote-calculator)
[![Node](https://img.shields.io/badge/node-%3E%3D18.0.0-brightgreen.svg)](https://nodejs.org/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û –ø—Ä–æ–µ–∫—Ç–µ](#–æ-–ø—Ä–æ–µ–∫—Ç–µ)
- [–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v2.3.1](#—á—Ç–æ-–Ω–æ–≤–æ–≥–æ-–≤-v231)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#api-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
- [Production –¥–µ–ø–ª–æ–π](#production-–¥–µ–ø–ª–æ–π)
- [–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–º–∏–≥—Ä–∞—Ü–∏–∏-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [Changelog](#changelog)
- [Roadmap](#roadmap)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [Troubleshooting](#troubleshooting)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#–ª–∏—Ü–µ–Ω–∑–∏—è)

---

## –û –ø—Ä–æ–µ–∫—Ç–µ

**MAGELLANIA CRM** - —ç—Ç–æ Full-Stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –≤ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–º –±–∏–∑–Ω–µ—Å–µ. –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç multi-tenancy –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –∫–∞—Ç–∞–ª–æ–≥–∏ —É—Å–ª—É–≥ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –∏ –≥–∏–±–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—Ç–∞–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

‚úÖ **Multi-tenancy** - –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º
‚úÖ **JWT Authentication** - –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å —Ç–æ–∫–µ–Ω–∞–º–∏
‚úÖ **SQLite Database** - –Ω–∞–¥–µ–∂–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚úÖ **Regional Catalogs** - –∫–∞—Ç–∞–ª–æ–≥–∏ —É—Å–ª—É–≥ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º (Ushuaia, El Calafate, Buenos Aires)
‚úÖ **Auto-save** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–º–µ—Ç
‚úÖ **Import/Export** - –ø–æ–ª–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ JSON
‚úÖ **Migration System** - –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã –ë–î
‚úÖ **Docker Support** - –≥–æ—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã –¥–ª—è –¥–µ–ø–ª–æ—è

---

## –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v2.3.1

### üî• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (26 –Ω–æ—è–±—Ä—è 2025)

#### 1. JWT Authentication Flow (CRITICAL FIX)
**–ü—Ä–æ–±–ª–µ–º–∞:** –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `login.html` - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/v1/auth/login` –≤–º–µ—Å—Ç–æ session API
- JWT —Ç–æ–∫–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `localStorage`
- Auth guard —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### 2. Catalog Import & Display (CRITICAL FIX)
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞—Ç–∞–ª–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏—Å—å, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ 0 —É—Å–ª—É–≥
**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ merge –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ templates –ø–æ ID
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ JSON –≤ API endpoint `GET /api/v1/catalogs/:id`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–∫–∏ `region` –≤ –ë–î
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ `deleted_at` –ø—Ä–∏ UPSERT

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:**
- `login.html` - JWT auth flow
- `index.html:9742-9806` - merge logic –¥–ª—è catalogs
- `storage/SQLiteStorage.js:661` - region fallback
- `storage/SQLiteStorage.js:218` - deleted_at reset –≤ UPSERT
- `routes/api-v1/catalogs.js:87-95` - JSON parsing

#### 3. –ê–∫—Ç—É–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ:
- **Ushuaia**: 60 —É—Å–ª—É–≥, 23 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- **El Calafate**: 17 —É—Å–ª—É–≥, 9 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **Buenos Aires**: 2 —É—Å–ª—É–≥–∏, 6 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–ò–¢–û–ì–û**: 79 –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å–ª—É–≥

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js** 18.x –∏–ª–∏ –≤—ã—à–µ
- **SQLite3** (–≤—Å—Ç—Ä–æ–µ–Ω –≤ Node.js)
- **Git** (–¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <your-repo-url>
cd quote-calculator

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä (–ø–æ—Ä—Ç 4000)
npm start

# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open http://localhost:4000
```

### Production credentials

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ production —Å–∏—Å—Ç–µ–º—É:

```yaml
Email:              admin@magellania.com
Password:           magellania2025
Username:           superadmin
Organization ID:    magellania-org
Organization Name:  Magellania
Role:               admin
```

–≠—Ç–∏ credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–µ–π `db/migrations/010_superadmin_setup.sql`.

---

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üè¢ Multi-tenancy
- –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º (`organization_id`)
- –ö–∞–∂–¥–∞—è —Å–º–µ—Ç–∞/–∫–∞—Ç–∞–ª–æ–≥ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- Superadmin –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –≤—Å–µ—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π

### üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- JWT —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
- –ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö API endpoints —á–µ—Ä–µ–∑ middleware `requireAuth`
- RBAC (Role-Based Access Control) - —Ä–æ–ª–∏ `admin`, `user`
- XSS –∑–∞—â–∏—Ç–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### üìö –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏
- –ö–∞—Ç–∞–ª–æ–≥–∏ —É—Å–ª—É–≥ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º (Ushuaia, El Calafate, Buenos Aires)
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —É—Å–ª—É–≥ —Å –∏–∫–æ–Ω–∫–∞–º–∏
- –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –≤ JSON
- Merge duplicates –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- Soft delete (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –∫–∞—Ç–∞–ª–æ–≥–æ–≤)

### üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–º–µ—Ç–∞–º–∏
- –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–º–µ—Ç
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞
- Custom —É—Å–ª—É–≥–∏ (–Ω–µ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞)
- Bulk operations (–º–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)
- –†–∞—Å—á–µ—Ç —Å —É—á–µ—Ç–æ–º:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ —á–µ–ª–æ–≤–µ–∫ (PAX)
  - –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –Ω–∞—Ü–µ–Ω–æ–∫ –Ω–∞ —É—Å–ª—É–≥–∏
  - –°–∫—Ä—ã—Ç–æ–π –º–∞—Ä–∂–∏
  - –ù–î–°

### üì§ –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç
- –ü–æ–ª–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö (catalogs, estimates, settings) –≤ JSON
- –ò–º–ø–æ—Ä—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π merge (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ ID)
- –§–æ—Ä–º–∞—Ç –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω (`version: "2.3.1"`)
- –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ñ–æ—Ä–º–∞—Ç–æ–º v1.0.0

### üñ®Ô∏è –ü–µ—á–∞—Ç—å –ö–ü
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω –ø–µ—á–∞—Ç–∏
- –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–µ—Ä—Å–∏—è –ë–ï–ó –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —É—Å–ª—É–≥–∞–º
- –ò—Ç–æ–≥–æ–≤—ã–µ —Å—É–º–º—ã —Å –ù–î–°

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Tech Stack

**Backend:**
- Node.js 18+ / Express.js 4.18
- SQLite3 (better-sqlite3)
- JWT (jsonwebtoken)
- bcrypt –¥–ª—è –ø–∞—Ä–æ–ª–µ–π

**Frontend:**
- Vanilla JavaScript ES6+ (SPA)
- HTML5 + CSS3 Custom Properties
- Lucide Icons

**DevOps:**
- Docker + Docker Compose
- PM2 –¥–ª—è production
- SQLite –º–∏–≥—Ä–∞—Ü–∏–∏

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
quote-calculator/
‚îú‚îÄ‚îÄ server-with-db.js           # Main Express server (JWT + SQLite)
‚îú‚îÄ‚îÄ index.html                  # Frontend SPA (~10K lines)
‚îú‚îÄ‚îÄ login.html                  # Login page with JWT auth
‚îú‚îÄ‚îÄ package.json                # Dependencies
‚îÇ
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îî‚îÄ‚îÄ SQLiteStorage.js        # Database abstraction layer
‚îÇ
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ jwt-auth.js             # JWT validation middleware
‚îÇ   ‚îî‚îÄ‚îÄ rbac.js                 # Role-based access control
‚îÇ
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ api-v1.js               # Main API router
‚îÇ   ‚îî‚îÄ‚îÄ api-v1/
‚îÇ       ‚îú‚îÄ‚îÄ auth.js             # /api/v1/auth/* (login, register)
‚îÇ       ‚îú‚îÄ‚îÄ catalogs.js         # /api/v1/catalogs/* (CRUD)
‚îÇ       ‚îú‚îÄ‚îÄ estimates.js        # /api/v1/estimates/* (CRUD)
‚îÇ       ‚îî‚îÄ‚îÄ data.js             # /api/v1/data/* (import/export)
‚îÇ
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ quotes.db               # Main SQLite database
‚îÇ   ‚îú‚îÄ‚îÄ schema.sql              # Full schema definition
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îú‚îÄ‚îÄ runner.js           # Migration runner
‚îÇ       ‚îú‚îÄ‚îÄ 001_add_multitenancy.sql
‚îÇ       ‚îú‚îÄ‚îÄ 002_remove_filename_unique.sql
‚îÇ       ‚îú‚îÄ‚îÄ ...
‚îÇ       ‚îî‚îÄ‚îÄ 010_superadmin_setup.sql
‚îÇ
‚îú‚îÄ‚îÄ docs/                       # MkDocs documentation
‚îÇ   ‚îú‚îÄ‚îÄ index.md
‚îÇ   ‚îú‚îÄ‚îÄ ru/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user-guide/         # User documentation
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ developer-guide/    # Developer documentation
‚îÇ   ‚îî‚îÄ‚îÄ CODE_MAP.md             # Code navigation map
‚îÇ
‚îú‚îÄ‚îÄ Dockerfile                  # Docker image
‚îú‚îÄ‚îÄ docker-compose.yml          # Docker Compose config
‚îî‚îÄ‚îÄ CLAUDE.md                   # Developer instructions
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

#### `users`
- `id` (TEXT PRIMARY KEY) - User UUID
- `email`, `password_hash`, `username`
- `organization_id` (TEXT) - Multi-tenancy
- `role` (TEXT) - admin/user

#### `organizations`
- `id` (TEXT PRIMARY KEY) - Org UUID
- `name`, `domain`, `settings` (JSON)

#### `catalogs`
- `id` (TEXT PRIMARY KEY) - Catalog UUID
- `name`, `slug`, `region`
- `data` (TEXT) - JSON —Å templates/categories
- `organization_id` - Tenant isolation
- `deleted_at` - Soft delete

#### `estimates`
- `id` (TEXT PRIMARY KEY) - Estimate UUID
- `filename` - Display name (NOT unique!)
- `data` (TEXT) - JSON —Å–æ –≤—Å–µ–π —Å–º–µ—Ç–æ–π
- `organization_id` - Tenant isolation
- `data_version` - Optimistic locking

#### `settings`
- Global/organization/user settings
- `scope`, `scope_id`
- `key`, `value` (JSON)

**Schema –≤–µ—Ä—Å–∏—è:** `1.0` (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `schema_migrations` table)

---

## API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### Authentication

#### `POST /api/v1/auth/register`
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**Request:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "username": "username",
  "organizationName": "My Company"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": "user_uuid",
      "email": "user@example.com",
      "username": "username",
      "role": "admin",
      "organization_id": "org_uuid"
    }
  }
}
```

#### `POST /api/v1/auth/login`
–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Request:**
```json
{
  "email": "admin@magellania.com",
  "password": "magellania2025"
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": { ... }
  }
}
```

---

### Catalogs API

**–í—Å–µ endpoints —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:** `Authorization: Bearer <jwt_token>`

#### `GET /api/v1/catalogs`
–°–ø–∏—Å–æ–∫ –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**Response:**
```json
{
  "success": true,
  "data": {
    "catalogs": [
      {
        "id": "catalog_uuid",
        "name": "Ushuaia",
        "slug": "ushuaia",
        "region": "Ushuaia",
        "templates_count": 60,
        "categories_count": 23,
        "visibility": "organization",
        "created_at": 1732549200,
        "updated_at": 1732635600
      }
    ]
  }
}
```

#### `GET /api/v1/catalogs/:id`
–ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –ø–æ ID (—Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏)

**Response:**
```json
{
  "success": true,
  "data": {
    "templates": [
      {
        "id": "custom_1760104404585",
        "name": "–ö–µ–º–ø–∏–Ω–≥, –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ø–∞–ª–∞—Ç–∫–∞ + –ø–∏—Ç–∞–Ω–∏–µ",
        "category": "torres_del_paine",
        "description": "W express (4 –¥–Ω—è/3 –Ω–æ—á–∏)",
        "contractor": "Torres del paine",
        "icon": "‚õ∫",
        "price": 534,
        "region": "Ushuaia"
      }
    ],
    "categories": [
      {
        "id": "torres_del_paine",
        "name": "Torres del Paine",
        "icon": "üèîÔ∏è"
      }
    ],
    "region": "Ushuaia"
  }
}
```

#### `POST /api/v1/catalogs`
–°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥

**Request:**
```json
{
  "name": "Ushuaia",
  "data": {
    "templates": [...],
    "categories": [...],
    "region": "Ushuaia"
  },
  "visibility": "organization"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Catalog saved successfully"
}
```

---

### Estimates API

#### `GET /api/v1/estimates`
–°–ø–∏—Å–æ–∫ —Å–º–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

**Response:**
```json
{
  "success": true,
  "data": {
    "estimates": [
      {
        "id": "estimate_uuid",
        "filename": "Quote 2025-11-26",
        "created_at": 1732549200,
        "updated_at": 1732635600,
        "client_name": "John Doe",
        "total": 15340.50,
        "services_count": 12
      }
    ]
  }
}
```

#### `GET /api/v1/estimates/:id`
–ü–æ–ª—É—á–∏—Ç—å —Å–º–µ—Ç—É –ø–æ ID

**Response:**
```json
{
  "success": true,
  "data": {
    "id": "estimate_uuid",
    "filename": "Quote 2025-11-26",
    "services": [...],
    "paxCount": 27,
    "hiddenMarkup": 10,
    "taxRate": 21,
    "clientInfo": { ... },
    "metadata": { ... }
  }
}
```

#### `POST /api/v1/estimates`
–°–æ–∑–¥–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–º–µ—Ç—É

**Request:**
```json
{
  "filename": "Quote 2025-11-26",
  "data": {
    "services": [...],
    "paxCount": 27,
    "hiddenMarkup": 10,
    "taxRate": 21,
    "clientInfo": { ... }
  }
}
```

#### `DELETE /api/v1/estimates/:id`
–£–¥–∞–ª–∏—Ç—å —Å–º–µ—Ç—É (soft delete)

---

### Data Import/Export

#### `POST /api/v1/data/export`
–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö

**Response:**
```json
{
  "version": "2.3.1",
  "exportDate": "2025-11-26T12:00:00Z",
  "data": {
    "catalogs": { ... },
    "estimates": [...],
    "settings": { ... }
  }
}
```

#### `POST /api/v1/data/import`
–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–∞–π–ª–∞

**Request:** multipart/form-data —Å JSON —Ñ–∞–π–ª–æ–º

**Response:**
```json
{
  "success": true,
  "message": "Data imported successfully",
  "stats": {
    "catalogsImported": 3,
    "estimatesImported": 15,
    "settingsImported": 5
  }
}
```

---

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```bash
# Server
PORT=4000
NODE_ENV=production

# JWT
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production

# Database
DB_PATH=./db/quotes.db

# Storage
STORAGE_TYPE=sqlite

# Session (legacy, not used)
SESSION_SECRET=your-session-secret-key
```

### Docker

**docker-compose.yml:**

```yaml
version: '3.8'

services:
  app:
    build: .
    ports:
      - "4000:4000"
    environment:
      - PORT=4000
      - NODE_ENV=production
      - JWT_SECRET=${JWT_SECRET}
      - STORAGE_TYPE=sqlite
    volumes:
      - ./db:/app/db
    restart: unless-stopped
```

**–ó–∞–ø—É—Å–∫:**

```bash
# Build and start
docker-compose up -d

# View logs
docker-compose logs -f

# Stop
docker-compose down
```

---

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ dev mode (nodemon)
npm run dev

# –ó–∞–ø—É—Å—Ç–∏—Ç—å production
npm start
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞

**Frontend (index.html):**
- `ProfessionalQuoteCalculator` - –≥–ª–∞–≤–Ω—ã–π –∫–ª–∞—Å—Å (~10K —Å—Ç—Ä–æ–∫)
- `APIClient` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
- Event-driven architecture
- Debounced updates –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**Backend (server-with-db.js):**
- Express.js —Å middleware
- JWT authentication
- SQLite —á–µ—Ä–µ–∑ better-sqlite3
- RESTful API design

### Code Navigation

üìã **–í–ê–ñ–ù–û:** –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –ª—é–±–æ–π –∑–∞–¥–∞—á–∏ —á–∏—Ç–∞–π—Ç–µ `docs/CODE_MAP.md`!

Code Map —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –¢–æ—á–Ω—ã–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π (—Ñ–∞–π–ª:—Å—Ç—Ä–æ–∫–∞)
- Caller/callee –≥—Ä–∞—Ñ—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ race conditions
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
- Integration points

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```
–ó–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–∏—Ç—å autosave
1. –û—Ç–∫—Ä—ã–≤–∞—é CODE_MAP.md ‚Üí "Known Issues"
2. –í–∏–∂—É: isLoadingQuote guard flag, index.html:9430
3. –°—Ä–∞–∑—É –æ—Ç–∫—Ä—ã–≤–∞—é index.html:9430
4. –§–∏–∫—Å –∑–∞ 1 –º–∏–Ω—É—Ç—É –≤–º–µ—Å—Ç–æ 10 –º–∏–Ω—É—Ç –ø–æ–∏—Å–∫–∞
```

---

## Production –¥–µ–ø–ª–æ–π

### Railway.app (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç –Ω–∞ Railway**
2. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   - `PORT=4000`
   - `JWT_SECRET=<–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–ª—é—á>`
   - `NODE_ENV=production`

4. **Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç `npm install`
   - –ó–∞–ø—É—Å—Ç–∏—Ç `npm start`
   - –°–æ–∑–¥–∞—Å—Ç –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ–º–µ–Ω

### VPS (Ubuntu/Debian)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Node.js 18+
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
git clone <repo-url> /var/www/quote-calculator
cd /var/www/quote-calculator

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install --production

# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
nano .env
# (–¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å PM2
npm install -g pm2
pm2 start server-with-db.js --name quote-calculator
pm2 startup
pm2 save

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx reverse proxy (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### Docker Production

```bash
# Build –æ–±—Ä–∞–∑
docker build -t quote-calculator:2.3.1 .

# Run –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker run -d \
  -p 4000:4000 \
  -e JWT_SECRET=your-secret \
  -e NODE_ENV=production \
  -v $(pwd)/db:/app/db \
  --name quote-calculator \
  --restart unless-stopped \
  quote-calculator:2.3.1
```

---

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `db/migrations/`.

**–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫:**

```bash
cd db/migrations
node runner.js
```

### –°–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π

1. **001_add_multitenancy.sql** - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ multi-tenancy (organization_id, owner_id)
2. **002_remove_filename_unique.sql** - –£–±—Ä–∞–ª–∏ UNIQUE constraint —Å filename
3. **003_fix_settings_multitenancy.sql** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ settings –¥–ª—è multi-tenancy
4. **004_add_users_auth.sql** - –¢–∞–±–ª–∏—Ü–∞ users —Å JWT auth
5. **005_migrate_owner_id.sql** - –ú–∏–≥—Ä–∞—Ü–∏—è owner_id
6. **006_add_multi_tenancy_fields.sql** - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
7. **007_migrate_existing_data.sql** - –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
8. **008_make_fields_not_null.sql** - NOT NULL constraints
9. **009_fix_settings_scope.sql** - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ scope settings
10. **010_superadmin_setup.sql** - –°–æ–∑–¥–∞–Ω–∏–µ superadmin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
cd db/migrations

# –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å –Ω–æ–º–µ—Ä–æ–º —Å–ª–µ–¥—É—é—â–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
nano 011_your_migration_name.sql
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:**

```sql
-- Migration: 011 Your Migration Name
-- Date: 2025-11-26

BEGIN TRANSACTION;

-- Your SQL changes here
ALTER TABLE your_table ADD COLUMN new_field TEXT;

-- Update schema version
UPDATE schema_migrations SET version = 11, applied_at = CURRENT_TIMESTAMP WHERE id = 1;

COMMIT;
```

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º (7 –¥–Ω–µ–π)
- ‚úÖ bcrypt –¥–ª—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π (salt rounds: 10)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö API endpoints —á–µ—Ä–µ–∑ middleware

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ RBAC (admin, user roles)
- ‚úÖ Organization-level isolation
- ‚úÖ Superuser –¥–æ—Å—Ç—É–ø –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫
- ‚úÖ XSS prevention (textContent –≤–º–µ—Å—Ç–æ innerHTML)
- ‚úÖ SQL injection prevention (prepared statements)
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Rate limiting (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á–µ—Ä–µ–∑ middleware)
- ‚úÖ File size validation (max 5MB –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞)

### Best Practices
- ‚úÖ ID-First Pattern (UUID –∫–∞–∫ primary key, –Ω–µ filename)
- ‚úÖ Optimistic locking (data_version)
- ‚úÖ Soft delete (deleted_at timestamp)
- ‚úÖ Single Source of Truth (–æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è runtime –¥–∞–Ω–Ω—ã—Ö)

---

## Changelog

### v2.3.1 (26 –Ω–æ—è–±—Ä—è 2025)

**CRITICAL FIXES:**

üîí **JWT Authentication Flow**
- Fixed `login.html` - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `/api/v1/auth/login` –≤–º–µ—Å—Ç–æ session API
- JWT —Ç–æ–∫–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- Auth guard –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

üìö **Catalog Import & Display**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ merge logic –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ templates –ø–æ ID (index.html:9742-9806)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω JSON parsing –≤ `GET /api/v1/catalogs/:id` (routes/api-v1/catalogs.js:87-95)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `region` column (SQLiteStorage.js:661)
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ `deleted_at` –ø—Ä–∏ UPSERT (SQLiteStorage.js:218)

üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- Ushuaia: 60 —É—Å–ª—É–≥, 23 –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- El Calafate: 17 —É—Å–ª—É–≥, 9 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- Buenos Aires: 2 —É—Å–ª—É–≥–∏, 6 –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–ò–¢–û–ì–û: 79 –∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Å–ª—É–≥**

üìÑ **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–º–ø–æ—Ä—Ç—É (CLEAN_IMPORT_READY.md)
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (AUTH_FIX_SUMMARY.md, CATALOG_IMPORT_FIX.md)
- –°–æ–∑–¥–∞–Ω comprehensive README.md

### v2.3.0 (20 –æ–∫—Ç—è–±—Ä—è 2025)

**Production Ready Release**

üóÑÔ∏è **SQLite Database**
- –ü–µ—Ä–µ—Ö–æ–¥ —Å file-based storage –Ω–∞ SQLite
- –ú–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (10 –º–∏–≥—Ä–∞—Ü–∏–π)
- Multi-tenancy architecture
- Optimistic locking (data_version)

üîê **JWT Authentication**
- –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- Middleware –¥–ª—è –∑–∞—â–∏—Ç—ã endpoints
- RBAC (admin/user roles)

üèóÔ∏è **API v1**
- RESTful API design
- `/api/v1/auth/*` - authentication
- `/api/v1/catalogs/*` - catalog CRUD
- `/api/v1/estimates/*` - estimate CRUD
- `/api/v1/data/*` - import/export

üìä **Regional Catalogs**
- –ö–∞—Ç–∞–ª–æ–≥–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º (Ushuaia, El Calafate, Buenos Aires)
- 245+ —É—Å–ª—É–≥ –≤ –∫–∞—Ç–∞–ª–æ–≥–∞—Ö
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –∏–∫–æ–Ω–∫–∞–º–∏

üêõ **Bug Fixes:**
- Services "sticking" –º–µ–∂–¥—É —Å–º–µ—Ç–∞–º–∏ (guard flag `isLoadingQuote`)
- Cyrillic filename errors –ø—Ä–∏ rename
- Import compatibility v1.0.0 ‚Üî v1.1.0
- transliterate is not a function
- apiClient is not defined

### v2.2.0 (29 –¥–µ–∫–∞–±—Ä—è 2024)

üéâ **–°–µ—Ä–≤–µ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**
- Express.js backend
- File-based storage (catalog/, estimate/, backup/)
- –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–º–µ—Ç
- –ê–≤—Ç–æ–±—ç–∫–∞–ø—ã

---

## Roadmap

### v2.4.0 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] WebSocket real-time sync
- [ ] Collaborative editing (multiple users)
- [ ] Enhanced reporting (PDF export)
- [ ] Mobile app (React Native)

### v2.5.0 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] PostgreSQL support (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ SQLite)
- [ ] Redis caching
- [ ] Elasticsearch –¥–ª—è –ø–æ–∏—Å–∫–∞
- [ ] Advanced analytics

### v3.0.0 (–ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è)
- [ ] Microservices architecture
- [ ] GraphQL API
- [ ] React frontend (–∑–∞–º–µ–Ω–∞ vanilla JS)
- [ ] Kubernetes deployment

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

üìñ **[docs/index.md](docs/index.md)** - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ MkDocs wiki

**–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- üë§ [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è](docs/ru/user-guide/index.md)
- üìñ [FAQ](docs/ru/user-guide/troubleshooting/faq.md)

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**
- üë®‚Äçüíª [–†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞](docs/ru/developer-guide/index.md)
- üèóÔ∏è [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](docs/ru/developer-guide/architecture/index.md)
- üîß [API Reference](docs/ru/developer-guide/api-reference/index.md)
- üó∫Ô∏è [CODE_MAP.md](docs/CODE_MAP.md) - **READ FIRST!**

**–ö–†–ò–¢–ò–ß–ù–û:**
- [–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö](docs/ru/developer-guide/data-integrity/index.md)
- [ID-First Pattern](docs/ru/developer-guide/data-integrity/id-first-pattern.md)
- [Single Source of Truth](docs/ru/developer-guide/data-integrity/single-source-truth.md)

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MkDocs —Å–∞–π—Ç–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å dev server
mkdocs serve

# –ë–∏–ª–¥ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–∞–π—Ç–∞
mkdocs build
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: Cyclical redirect –ø–æ—Å–ª–µ login

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –º–µ–∂–¥—É `/login` –∏ `/`
- "No JWT token found, redirecting to login..."

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API endpoint
# –í login.html –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
fetch('/api/v1/auth/login', ...)  // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
# –ù–ï:
fetch('/api/auth/login', ...)      // ‚ùå –°—Ç–∞—Ä—ã–π session API
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—Ç–∞–ª–æ–≥–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è (0 —É—Å–ª—É–≥)

**–°–∏–º–ø—Ç–æ–º—ã:**
- –£—Å–ø–µ—à–Ω—ã–π –∏–º–ø–æ—Ä—Ç, –Ω–æ UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "0 —É—Å–ª—É–≥"
- –í –ë–î –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ, –Ω–æ templates.length === 0

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON parsing –≤ API
# routes/api-v1/catalogs.js –¥–æ–ª–∂–µ–Ω –ø–∞—Ä—Å–∏—Ç—å data:
const catalogData = {
    ...catalog,
    data: JSON.parse(catalog.data)  // ‚úÖ –í–ê–ñ–ù–û!
};
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç 4000 –∑–∞–Ω—è—Ç

```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –ø–æ—Ä—Ç—É
lsof -i :4000

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
kill -9 <PID>

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç
export PORT=4001
npm start
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
chmod 755 db/
touch db/quotes.db

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
cd db/migrations
node runner.js
```

### –ü—Ä–æ–±–ª–µ–º–∞: JWT token expired

**–°–∏–º–ø—Ç–æ–º—ã:**
- 401 Unauthorized errors
- "Token has expired"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í—ã–π—Ç–∏ –∏ –≤–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ
# –¢–æ–∫–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 7 –¥–Ω–µ–π, –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω re-login
```

### –ü—Ä–æ–±–ª–µ–º–∞: Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é —Å—Ö–µ–º—ã
sqlite3 db/quotes.db "SELECT * FROM schema_migrations;"

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
cd db/migrations
node runner.js

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –æ—Ç–∫–∞—Ç–∏—Ç—å –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å
sqlite3 db/quotes.db ".restore db/quotes.db.backup"
```

---

## –ö–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä—ã

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Pull Request:

1. –ü—Ä–æ—á–∏—Ç–∞–π—Ç–µ `docs/CODE_MAP.md`
2. –°–ª–µ–¥—É–π—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –∏–∑ `docs/ru/developer-guide/data-integrity/`
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
5. –û–±–Ω–æ–≤–∏—Ç–µ CHANGELOG

### Code Style

- **JavaScript:** ESLint —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ ES6+
- **–û—Ç—Å—Ç—É–ø—ã:** 4 –ø—Ä–æ–±–µ–ª–∞
- **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:** –ù–∞ —Ä—É—Å—Å–∫–æ–º (–¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞)
- **Naming:** camelCase –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, PascalCase –¥–ª—è –∫–ª–∞—Å—Å–æ–≤

### Testing

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã (–∫–æ–≥–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã)
npm test

# Lint
npm run lint
```

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

Copyright (c) 2025 MAGELLANIA CRM

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–ü—Ä–æ–µ–∫—Ç:** MAGELLANIA CRM - Quote Calculator
**–í–µ—Ä—Å–∏—è:** 2.3.1
**–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 26 –Ω–æ—è–±—Ä—è 2025

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/` (MkDocs)
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `CLAUDE.md`
**Code Navigation:** `docs/CODE_MAP.md`

---

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –≠—Ç–æ production-ready —Å–∏—Å—Ç–µ–º–∞. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –±–∞–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã. –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `.env` —Ñ–∞–π–ª —Å production credentials
2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
3. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (catalogs)
4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
5. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è —Å credentials: `admin@magellania.com` / `magellania2025`

---

**Made with ‚ù§Ô∏è for Tourism Industry**
